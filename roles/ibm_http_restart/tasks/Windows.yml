---
- name: Restart IBM HTTP Server on Windows
  block:
    - name: Restart IBM HTTP Server service
      win_service:
        name: "{{ ibm_http_service_name }}"
        state: restarted
        start_mode: auto

    - name: Wait for IBM HTTP Server to restart
      wait_for:
        port: "{{ ibm_http_port | default(80) }}"
        timeout: "{{ ibm_http_timeout | default(30) }}"

    - name: Verify IBM HTTP Server is running after restart
      win_uri:
        url: "http://localhost:{{ ibm_http_port | default(80) }}"
        method: GET
      register: http_check
      ignore_errors: true

    - name: Display restart result
      debug:
        msg: "IBM HTTP Server restarted successfully on {{ ansible_hostname }}"
  rescue:
    - name: Restart failed
      fail:
        msg: "Failed to restart IBM HTTP Server on {{ ansible_hostname }}"
